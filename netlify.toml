[build]
  publish = "."
  command = "echo 'Building AI Tools Library website'"

[build.environment]
  NODE_VERSION = "18"

# 重定向规则 - 排除静态文件
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  force = false
  conditions = {Language = ["en"], Country = ["US"]}
  
# 排除验证文件（不被重定向到index.html）
[[redirects]]
  from = "/ads.txt"
  to = "/ads.txt"
  status = 200
  force = true

[[redirects]]
  from = "/google*.html"
  to = "/:splat"
  status = 200
  force = true

[[redirects]]
  from = "/robots.txt"
  to = "/robots.txt"
  status = 200
  force = true

[[redirects]]
  from = "/sitemap.xml"
  to = "/sitemap.xml"
  status = 200
  force = true

# 自定义域名设置（示例）
[[redirects]]
  from = "https://aitoolslibrary.com/*"
  to = "https://ai-tools-library.netlify.app/:splat"
  status = 301

# 安全头
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "camera=(), microphone=(), geolocation=()"

# Content Security Policy for Google services
[[headers]]
  for = "/*"
  [headers.values]
    Content-Security-Policy = """
      default-src 'self';
      script-src 'self' https://pagead2.googlesyndication.com https://www.googletagmanager.com https://translate.google.com https://translate.googleapis.com;
      style-src 'self' 'unsafe-inline';
      img-src 'self' data: https://*.google.com https://*.googleapis.com https://*.gstatic.com;
      font-src 'self' data:;
      connect-src 'self' https://*.google.com https://*.googleapis.com;
      frame-src https://www.google.com;
    """

# ads.txt特殊配置
[[headers]]
  for = "/ads.txt"
  [headers.values]
    Access-Control-Allow-Origin = "*"
    Cache-Control = "no-cache, no-store, must-revalidate"
    Content-Type = "text/plain; charset=utf-8"

# 缓存策略
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000"

[[headers]]
  for = "/*.css"
  [headers.values]
    Cache-Control = "public, max-age=604800"

[[headers]]
  for = "/*.js"
  [headers.values]
    Cache-Control = "public, max-age=604800"

# SEO优化
[context.production.environment]
  SITE_URL = "https://aitoolslibrary.com"

# 环境变量（用于Google服务）
[context.production.environment]
  GOOGLE_ADSENSE_ID = "ca-pub-YOUR_PUBLISHER_ID"
  GOOGLE_ANALYTICS_ID = "UA-XXXXXXXXX-X"

# 部署分支设置
[context.deploy-preview]
  command = "echo 'Deploy preview build'"

[context.branch-deploy]
  command = "echo 'Branch deploy build'"